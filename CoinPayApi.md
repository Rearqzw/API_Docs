# 币支付接口说明

* 目前币赢钱包支持安卓与ios，[点击下载币赢钱包](https://yysyservice.com:8996/down.html)
* [币支付后台代理结算系统](http://yysyservice.com:20006/)，若无法打开链接，请在浏览器器手动输入http://yysyservice.com:20006/ ，注意是http，某些浏览器会自动将http改为https
* 接口请求的基础url为 https://yysyservice.com:20002
* 签名说明：这里的签名采用sha256对请求接口的url与参数带上key与时间戳(毫秒级-长度是13位的)进行加密得到密文，然后在请求中将密文赋给sign参数加进请求头里。
例如：get请求 https://yysyservice:20002/api/Pay   参数有symbol、openid、remark，则需要对 http://yysyservice:20002/api/Pay?accessKey=****&openid=1001&remark=111&symbol=usdt&timestamp=1567412503000 进行sha256加密（注意参数的排序是按照键进行升序排序的）然后在请求头里带上sign参数，值就是得到的密文
* 只要请求正常，接口统一返回200状态码，返回的Json格式为
&emsp;&emsp;
~~~~
{
  "success": true,
  "data": "string"
}
~~~~
* ## [各编程语言示例Demo](#demo)

## 接口列表

请求方法|类型|描述
----------------------|---------------------|-----------------------------|
[/api/Pay](#Pay)	|Get|请求收币地址
[/api/Pay/getbalance](#getbalance)	|Get|请求未确认余额
[/api/Pay/getOrderHistory](#getOrderHistory)	|Get|请求用户收币历史记录
[/api/ticker](#ticker)	|Get|获取服务器上当前币种的人民币价格
[/api/time](#time)	|Get|获取服务器当前时间
[商户回调(请仔细阅读)](#callback)	|Get|商户回调

<span id="Pay">

### /api/Pay 请求收币地址

##### 请求参数:&emsp;&emsp;

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
symbol	|true|string|币种，如btc|btc|btc、usdt
openid	|true|string|商户系统中用户的id||
remark	|false|string|预留字段，商户的自定义参数，将在回调中返回该数据||
accessKey	|true|string|商户向支付系统申请的key||
timestamp	|true|long|0时区的毫秒级时间戳||
sign	|true|string|签名，用申请的secret对请求的url（包括请求头参数）进行HMACSHA256加密，形成sign参数||

##### 返回参数:&emsp;&emsp;

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
success	|true|bool|请求是否成功|true|true、false
data	|true|json|若成功则返回地址，否则返回错误信息||


</span>

<span id="getbalance">

### /api/Pay/getbalance 请求未确认余额：

##### 请求参数:&emsp;&emsp;

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
openid	|true|string|商户系统中用户的id||
accessKey	|true|string|商户向支付系统申请的key||
timestamp	|true|long|0时区的毫秒级时间戳||
sign	|true|string|签名，用申请的secret对请求的url（包括请求头参数）进行HMACSHA256加密，形成sign参数||

##### 返回参数：&emsp;&emsp;
参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
success	|true|bool|请求是否成功|true|true、false
data	|true|JObject|若成功则返回各个币种的未确认金额，否则返回错误信息||

##### data说明：&emsp;&emsp;
参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
UnConfirmBTC	|true|decimal|btc的未确认金额||
UnConfirmUSDT	|true|decimal|usdt的未确认金额||

##### data示例：&emsp;&emsp;
~~~~
{
  "UnConfirmBTC": 1.0,
  "UnConfirmUSDT": 100
}
~~~~

</span>

<span id="getOrderHistory">

### /api/Pay/getOrderHistory 请求用户收币历史记录

##### 请求参数:（startTime与endTime都不传的话，会返回24小时内的数据；两个参数必须同时传才生效）

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
openid	|true|string|商户系统中用户的id||
accessKey	|true|string|商户向支付系统申请的key||
timestamp	|true|long|0时区的毫秒级时间戳||
sign	|true|string|签名，用申请的secret对请求的url（包括请求头参数）进行HMACSHA256加密，形成sign参数||
startTime	|false|long|查询的开始时间(0时区的毫秒级时间戳)||
endTime	|false|long|查询的结束时间(0时区的毫秒级时间戳)||

##### 返回参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
success	|true|bool|请求是否成功|true|true、false
data	|true|JArray|若成功则返回各个币种的订单记录，否则返回错误信息||

##### data说明：（返回json数组）&emsp;&emsp;
参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
Symbol	|true|string|币种|BTC|BTC、USDT
Amount	|true|decimal|未确认的数量||
Time	|true|decimal|订单生成时间||
Status	|true|decimal|订单状态||系统异常、已确认、未确认
Result	|true|decimal|订单是否成交，1表示成交，0表示未成交|1|1、0
Hash	|true|decimal|当前订单的交易哈希，通过币赢钱包转账不会产生哈希||
rmbPrice	|true|decimal|订单基于人民币的总价值||

##### data示例：&emsp;&emsp;
~~~~
[
	{
		"Symbol": USDT,
		"Amount": 10.0,
		"Time": "2019-09-03 10:42:03",
		"Status": "已确认",
		"Result": 1,
		"Hash": ,
		"rmbPrice": 72.1,
	},
	...
]
~~~~

</span>

<span id="ticker">

#### /api/ticker 获取服务器上当前币种的人民币价格

##### 请求参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
symbol	|true|string|币种|BTC|BTC、USDT
accessKey	|true|string|商户向支付系统申请的key||
timestamp	|true|long|0时区的毫秒级时间戳||
sign	|true|string|签名，用申请的secret对请求的url（包括请求头参数）进行HMACSHA256加密，形成sign参数||

##### 返回参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
success	|true|bool|请求是否成功|true|true、false
data	|true|JArray|若成功则返回请求币种的基于人民币的价格，否则返回错误信息||

</span>

<span id="time">

#### /api/time 获取服务器当前时间

##### 返回参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
success	|true|bool|请求是否成功|true|true、false
data	|true|JArray|若成功则返回服务器的当前时间（毫秒级时间戳），否则返回错误信息||

</span>

<span id="callback">

# 商户回调说明

* 商户回调接口由商户系统提供，需要在签订商务合同后，向我们申请开户，然后由商户技术人员（请务必在web接口里加入签名验证，以防止被人恶意攻击造成损失）提供两个以下格式的接口，并将url发给我们的客服，由客服录入系统，成功后可用客户提供的账号登录后台的结算系统（该系统可结算收益）：http://yysyservice.com:20006/

请求方法|类型|描述
----------------------|---------------------|-----------------------------|
[商户系统提供的web接口1](#callback1)	|Get|通知商户，商户的某个用户的账户收到了一笔帐，若是区块链上的转账则会在1个区块确认后调用 商户系统提供的web接口2 通知商户该笔帐已成交或失败；若是币赢钱包转账则不会调第二个接口，该帐直接入库
[商户系统提供的web接口2](#callback2)	|Get|通知商户，商户的某个用户的某笔账单是否成功

<span id="callback1">

### 商户系统提供的web接口1：（该接口必须是get请求，且参数需是以下参数）

##### 请求参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
openid	|true|string|商户系统中用户的id||
accessKey	|true|string|商户向支付系统申请的key||
timestamp	|true|long|0时区的毫秒级时间戳||
orderId	|true|string|订单号||
quota	|true|string|订单的基于人民币的总价值||
remark	|true|string|该参数是商户请求收币地址时传给系统的，若未传则返回空|NULL|
symbol	|true|string|币种|BTC|BTC、USDT
sign	|true|string|签名，用申请的secret对请求的url（包括请求头参数）进行HMACSHA256加密，形成sign参数||
confirm	|true|int|确认数（注意：这个参数不进行签名验证）若值为0，则会继续回调 web接口2，否则该交易成功，且不会回调 web接口2||

##### 返回参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
success	|true|bool|请求是否成功|true|true、false
msg	|true|string|若失败请返回错误信息||

</span>

<span id="callback2">

### 商户系统提供的web接口2（该接口必须是get请求，且参数需是以下参数）

##### 请求参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
openid	|true|string|商户系统中用户的id||
accessKey	|true|string|商户向支付系统申请的key||
timestamp	|true|long|0时区的毫秒级时间戳||
orderId	|true|string|订单号||
remark	|true|string|该参数是商户请求收币地址时传给系统的，若未传则返回空|NULL|
sign	|true|string|签名，用申请的secret对请求的url（包括请求头参数）进行HMACSHA256加密，形成sign参数||
confirm	|true|int|确认数（注意：这个参数不进行签名验证）若值为0，则表示充值失败，否则该交易成功||

##### 返回参数:

参数名称|是否必须|类型|描述|默认值|取值范围
----------------------|---------------------|-----------------------------|----------------------|---------------------|-----------------------------|
success	|true|bool|请求是否成功|true|true、false
msg	|true|string|若失败请返回错误信息||

</span>

</span>

<span id="demo">

# 各语言示例

## PHP<br>
 >  [介绍](https://github.com/coinWinApi/Api-PHP)<br>
 >  [示例](https://github.com/coinWinApi/Api-PHP-Demo)<br>

</span>
